<execution>
  <constraint>
    ## 项目环境限制
    - **个人项目资源**：开发时间和维护精力有限
    - **成本控制要求**：AI服务调用和服务器成本需要控制
    - **技术栈熟悉度**：优先选择团队熟悉的技术栈
    - **部署复杂度**：避免过于复杂的部署和运维需求
  </constraint>

  <rule>
    ## 架构设计强制规则
    - **模块化强制**：每个功能模块必须独立可测试
    - **API设计规范**：所有接口必须遵循RESTful或GraphQL规范
    - **错误处理完整**：每个模块必须有完整的错误处理机制
    - **文档同步更新**：架构变更必须同步更新文档
    - **性能基准设定**：关键功能必须设定性能基准
  </rule>

  <guideline>
    ## 架构设计指导原则
    - **渐进式复杂度**：从简单架构开始，逐步增加复杂性
    - **用户体验优先**：技术选择服务于用户体验目标
    - **可测试性设计**：架构设计必须支持自动化测试
    - **扩展性预留**：为未来功能扩展预留架构空间
    - **监控可观测**：设计时考虑系统监控和调试需求
  </guideline>

  <process>
    ## 架构设计标准流程
    
    ### Step 1: 需求分析和目标设定 (1天)
    
    ```mermaid
    flowchart TD
        A[收集需求] --> B[功能优先级排序]
        B --> C[技术约束分析]
        C --> D[性能目标设定]
        D --> E[架构目标确定]
    ```
    
    **关键输出**：
    - 功能需求清单和优先级
    - 非功能性需求（性能、安全、可用性）
    - 技术约束和限制条件
    - 架构设计目标和成功标准
    
    ### Step 2: 技术选型和架构设计 (1-2天)
    
    ```mermaid
    graph TD
        A[技术栈调研] --> B[架构模式选择]
        B --> C[模块划分设计]
        C --> D[接口设计]
        D --> E[数据流设计]
        E --> F[部署架构设计]
    ```
    
    **技术选型决策矩阵**：
    | 技术 | 学习成本 | 性能 | 社区支持 | 项目适配度 | 总分 |
    |------|----------|------|----------|------------|------|
    | React + Vite | 低 | 高 | 高 | 高 | 9/10 |
    | Vue + Nuxt | 中 | 高 | 高 | 中 | 8/10 |
    | Svelte + Kit | 高 | 高 | 中 | 中 | 7/10 |
    
    **关键输出**：
    - 技术栈选择和理由说明
    - 系统架构图和模块划分
    - API接口设计文档
    - 数据库设计方案
    
    ### Step 3: 详细设计和原型验证 (2-3天)
    
    ```mermaid
    flowchart LR
        A[详细设计] --> B[关键路径原型]
        B --> C[技术可行性验证]
        C --> D[性能测试]
        D --> E[设计优化调整]
    ```
    
    **原型验证重点**：
    - AI服务集成的响应时间和稳定性
    - 状态管理的复杂场景处理
    - 用户界面的交互流畅性
    - 数据持久化的可靠性
    
    ### Step 4: 实施计划和里程碑设定 (1天)
    
    ```mermaid
    gantt
        title AI互动小说项目实施计划
        dateFormat  YYYY-MM-DD
        section 基础架构
        项目初始化    :done, init, 2024-01-01, 1d
        基础框架搭建  :active, framework, after init, 3d
        AI服务集成    :ai-integration, after framework, 2d
        section 核心功能
        故事引擎开发  :story-engine, after ai-integration, 5d
        用户界面开发  :ui-dev, after story-engine, 4d
        状态管理实现  :state-mgmt, after ui-dev, 3d
        section 测试部署
        功能测试      :testing, after state-mgmt, 3d
        性能优化      :optimization, after testing, 2d
        部署上线      :deployment, after optimization, 1d
    ```
    
    ## AI互动小说特定架构模式
    
    ### 核心架构模式：分层 + 微服务
    
    ```mermaid
    graph TB
        subgraph "前端层"
            A[React应用] --> B[状态管理]
            B --> C[UI组件库]
        end
        
        subgraph "API网关层"
            D[Express/Fastify] --> E[路由管理]
            E --> F[中间件]
        end
        
        subgraph "业务逻辑层"
            G[故事引擎] --> H[AI对话服务]
            H --> I[用户管理]
            I --> J[状态持久化]
        end
        
        subgraph "数据层"
            K[PostgreSQL] --> L[Redis缓存]
            L --> M[向量数据库]
        end
        
        A --> D
        F --> G
        J --> K
    ```
    
    ### 关键设计模式应用
    
    **1. 状态机模式 - 故事流程管理**
    ```mermaid
    stateDiagram-v2
        [*] --> 故事开始
        故事开始 --> 角色对话
        角色对话 --> 用户选择
        用户选择 --> 故事分支
        故事分支 --> 角色对话
        故事分支 --> 故事结束
        故事结束 --> [*]
    ```
    
    **2. 观察者模式 - 事件驱动架构**
    ```mermaid
    graph LR
        A[用户操作] --> B[事件发布]
        B --> C[故事引擎监听]
        B --> D[AI服务监听]
        B --> E[状态管理监听]
        C --> F[故事更新]
        D --> G[AI响应]
        E --> H[状态同步]
    ```
    
    **3. 策略模式 - AI服务切换**
    ```mermaid
    graph TD
        A[AI服务接口] --> B[OpenAI策略]
        A --> C[Claude策略]
        A --> D[本地模型策略]
        B --> E[统一响应格式]
        C --> E
        D --> E
    ```
  </process>

  <criteria>
    ## 架构质量评价标准
    
    ### 功能性标准
    - ✅ 所有核心功能正常工作
    - ✅ AI对话响应时间 < 3秒
    - ✅ 系统可用性 > 99%
    - ✅ 支持并发用户数 > 100
    
    ### 可维护性标准
    - ✅ 代码覆盖率 > 80%
    - ✅ 模块耦合度低，内聚度高
    - ✅ 文档完整且与代码同步
    - ✅ 新功能开发周期 < 1周
    
    ### 可扩展性标准
    - ✅ 支持水平扩展
    - ✅ 新AI服务集成 < 1天
    - ✅ 新功能模块集成 < 3天
    - ✅ 数据库性能线性扩展
    
    ### 用户体验标准
    - ✅ 首屏加载时间 < 2秒
    - ✅ 交互响应时间 < 500ms
    - ✅ 移动端体验流畅
    - ✅ 错误处理用户友好
  </criteria>
</execution>
